@using ElectronicJova.Models
@model ApplicationUser

@{
    ViewData["Title"] = "Mi Perfil";
    var initials = string.IsNullOrEmpty(Model.Name) ? "?" : Model.Name.Substring(0, 1).ToUpper();
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-8">

            <!-- Page Header -->
            <div class="d-flex align-items-center mb-4 gap-3">
                <!-- Avatar with initials -->
                <div class="d-flex align-items-center justify-content-center rounded-circle fw-bold text-dark shadow-glow"
                     style="width: 64px; height: 64px; background: linear-gradient(135deg, var(--cyan), #fff); font-size: 1.5rem; flex-shrink: 0;">
                    @initials
                </div>
                <div>
                    <h2 class="fw-bold mb-0 text-light">Mi Perfil</h2>
                    <p class="mb-0 text-muted small">
                        <i class="bi bi-envelope me-1"></i>@Model.Email
                    </p>
                </div>
            </div>

            @if (TempData["success"] != null)
            {
                <div class="alert alert-success alert-dismissible fade show mb-4 border-success bg-opacity-10" role="alert">
                    <i class="bi bi-check-circle-fill me-2"></i>@TempData["success"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <form method="post" asp-action="Profile">
                @Html.AntiForgeryToken()
                <div asp-validation-summary="All" class="text-danger small mb-3"></div>

                <div class="row g-4">

                    <!-- ── Datos personales ─────────────────────── -->
                    <div class="col-12">
                        <div class="card border-secondary bg-card">
                            <div class="card-header border-0 px-4 pt-4 pb-0 bg-transparent">
                                <h5 class="fw-bold mb-0 text-light">
                                    <i class="bi bi-person-fill me-2 text-info"></i>Datos personales
                                </h5>
                            </div>
                            <div class="card-body px-4 pb-4 pt-3">
                                <div class="row g-3">
                                    <div class="col-12 col-md-6">
                                        <label asp-for="Name" class="form-label">Nombre completo</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-dark border-secondary"><i class="bi bi-person text-info"></i></span>
                                            <input asp-for="Name" class="form-control" placeholder="Tu nombre completo" />
                                        </div>
                                        <span asp-validation-for="Name" class="text-danger small"></span>
                                    </div>
                                    <div class="col-12 col-md-6">
                                        <label class="form-label">Correo electrónico</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-dark border-secondary"><i class="bi bi-envelope text-muted"></i></span>
                                            <input value="@Model.Email" class="form-control text-muted" disabled style="background-color: rgba(255,255,255,0.05);" />
                                        </div>
                                        <div class="form-text text-muted small">No se puede cambiar desde aquí.</div>
                                    </div>
                                    <div class="col-12 col-md-6">
                                        <label asp-for="PhoneNumber" class="form-label">Teléfono</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-dark border-secondary"><i class="bi bi-telephone text-info"></i></span>
                                            <input asp-for="PhoneNumber" class="form-control" placeholder="+52 55 1234 5678" />
                                        </div>
                                        <span asp-validation-for="PhoneNumber" class="text-danger small"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ── Dirección de envío ───────────────────── -->
                    <div class="col-12">
                        <div class="card border-secondary bg-card">
                            <div class="card-header border-0 px-4 pt-4 pb-0 bg-transparent">
                                <h5 class="fw-bold mb-0 text-light">
                                    <i class="bi bi-geo-alt-fill me-2 text-info"></i>Dirección de envío predeterminada
                                </h5>
                            </div>
                            <div class="card-body px-4 pb-4 pt-3">
                                <div class="row g-3">
                                    <div class="col-12">
                                        <label asp-for="StreetAddress" class="form-label">Calle y número</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-dark border-secondary"><i class="bi bi-signpost text-info"></i></span>
                                            <input asp-for="StreetAddress" class="form-control" placeholder="Av. Insurgentes 123" />
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-5">
                                        <label asp-for="City" class="form-label">Ciudad</label>
                                        <input asp-for="City" class="form-control" placeholder="Ciudad de México" />
                                    </div>
                                    <div class="col-12 col-md-4">
                                        <label asp-for="State" class="form-label">Estado</label>
                                        <input asp-for="State" class="form-control" placeholder="CDMX" />
                                    </div>
                                    <div class="col-12 col-md-3">
                                        <label asp-for="PostalCode" class="form-label">C.P.</label>
                                        <input asp-for="PostalCode" class="form-control" placeholder="06600" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ── Actions ─────────────────────────────── -->
                    <div class="col-12 d-flex gap-3">
                        <button type="submit" class="btn btn-primary px-4 py-2 fw-semibold shadow-info">
                            <i class="bi bi-floppy-fill me-2"></i>Guardar cambios
                        </button>
                        @if (User.IsInRole(ElectronicJova.Utilities.SD.Role_Admin))
                        {
                            <a asp-area="Admin" asp-controller="Dashboard" asp-action="Index" class="btn btn-outline-secondary px-4 py-2">
                                <i class="bi bi-arrow-left me-1"></i>Cancelar
                            </a>
                        }
                        else
                        {
                            <a asp-area="Customer" asp-controller="Order" asp-action="Index" class="btn btn-outline-secondary px-4 py-2">
                                <i class="bi bi-arrow-left me-1"></i>Cancelar
                            </a>
                        }
                    </div>

                </div>
            </form>

        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
